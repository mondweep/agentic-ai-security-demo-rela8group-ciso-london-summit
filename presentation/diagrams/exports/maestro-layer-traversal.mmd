graph TD
    subgraph Entry["üö™ ENTRY POINT - Layer 7: Agent Ecosystem"]
        direction TB
        Plugin[üì¶ Malicious Plugin Published on npm]
        Install[üë®‚Äçüíª Developer installs via package manager]
        Load[‚öôÔ∏è Plugin loaded at runtime]

        Plugin --> Install
        Install --> Load

        EntryVuln1[‚ùå No Plugin Signing]
        EntryVuln2[‚ùå No Package Verification]
        EntryVuln3[‚ùå No Runtime Sandboxing]
    end

    subgraph Lateral1["‚ÜîÔ∏è LATERAL MOVEMENT - Layer 3: Agent Frameworks"]
        direction TB
        RuntimeAccess[ü§ñ Full AgentRuntime Access Gained]
        ServiceReg[‚ò†Ô∏è Malicious Service Registration]
        EvalReg[‚ò†Ô∏è Backdoor Evaluator Installation]
        MemoryAccess[üß† Agent Memory Read/Write]

        RuntimeAccess --> ServiceReg
        RuntimeAccess --> EvalReg
        RuntimeAccess --> MemoryAccess

        LateralVuln1[‚ùå No Privilege Separation]
        LateralVuln2[‚ùå Unrestricted Service Registration]
        LateralVuln3[‚ùå No Memory Access Controls]
    end

    subgraph Lateral2["‚ÜîÔ∏è LATERAL MOVEMENT - Layer 4: Deployment and Infrastructure"]
        direction TB
        MultiAgent[ü§ñü§ñü§ñ Multi-Agent Communication]
        SharedMem[üóÑÔ∏è Shared Memory Poisoning]
        CrossContam[‚ò£Ô∏è Cross-Agent Contamination]

        MultiAgent --> SharedMem
        SharedMem --> CrossContam

        OrchVuln1[‚ùå No Agent Isolation]
        OrchVuln2[‚ùå Shared Memory Without ACLs]
        OrchVuln3[‚ùå No Inter-Agent Authentication]
    end

    subgraph Impact1["üí• IMPACT - Layer 2: Data Operations"]
        direction TB
        EnvVars[üîë Environment Variables Stolen]
        DBAccess[üóÑÔ∏è Database Credentials Exfiltrated]
        APIKeys[üí≥ API Keys Compromised]
        PrivKeys[üîê Private Keys Stolen]

        EnvVars --> DBAccess
        EnvVars --> APIKeys
        EnvVars --> PrivKeys

        DataVuln1[‚ùå Secrets in Environment]
        DataVuln2[‚ùå No Credential Encryption]
        DataVuln3[‚ùå Full process.env Access]
    end

    subgraph Impact2["üí• IMPACT - Layer 1: Foundational Models"]
        direction TB
        ModelAccess[üß† LLM Interaction Hijacked]
        PromptLog[üìù All Prompts Logged]
        ResponseMod[‚úèÔ∏è Responses Modified]

        ModelAccess --> PromptLog
        ModelAccess --> ResponseMod

        ModelVuln1[‚ùå No Model Access Controls]
        ModelVuln2[‚ùå Prompt/Response Logging]
        ModelVuln3[‚ùå No Output Validation]
    end

    subgraph Impact3["üí• IMPACT - Layer 4: Deployment and Infrastructure"]
        direction TB
        NetworkEgress[üåê Outbound C&C Connection]
        DataExfil[üì§ Data Exfiltration: 100K records]
        CryptoTheft[üí∏ Blockchain Transactions: $2M]
        Persistence[üîí Persistent Backdoor]

        NetworkEgress --> DataExfil
        NetworkEgress --> CryptoTheft
        NetworkEgress --> Persistence

        InfraVuln1[‚ùå No Egress Filtering]
        InfraVuln2[‚ùå No Network Segmentation]
        InfraVuln3[‚ùå No Behavioral Monitoring]
    end

    subgraph Governance["‚öñÔ∏è Layer 6: Security and Compliance"]
        direction TB
        NoPolicy[‚ùå No Supply Chain Policy]
        NoAudit[‚ùå No Third-Party Audit]
        NoIncidentPlan[‚ùå No AI Incident Response]
        NoThreatModel[‚ùå No AI Threat Model]

        GovImpact[üíº Regulatory Consequences:<br/>GDPR: $8M fine<br/>FCA Investigation<br/>Class-Action Lawsuit]
    end

    %% Attack Flow Connections
    Load -->|Boundary Violation #1| RuntimeAccess
    EvalReg -->|Boundary Violation #2| MultiAgent
    MemoryAccess -->|Boundary Violation #3| SharedMem
    CrossContam -->|Boundary Violation #4| EnvVars
    DBAccess -->|Boundary Violation #5| ModelAccess
    PromptLog -->|Boundary Violation #6| NetworkEgress

    %% Governance Oversight
    NoPolicy -.->|Enables| Plugin
    NoAudit -.->|Enables| RuntimeAccess
    NoIncidentPlan -.->|Delays| DataExfil
    NoThreatModel -.->|Enables| Persistence

    CryptoTheft --> GovImpact
    DataExfil --> GovImpact

    %% Styling
    classDef entry fill:#17a2b8,stroke:#0c5460,stroke-width:3px,color:#fff
    classDef lateral fill:#ffc107,stroke:#856404,stroke-width:3px,color:#000
    classDef impact fill:#dc3545,stroke:#721c24,stroke-width:3px,color:#fff
    classDef governance fill:#6c757d,stroke:#1d2124,stroke-width:3px,color:#fff
    classDef vuln fill:#f8d7da,stroke:#721c24,stroke-width:2px,color:#721c24

    class Entry entry
    class Lateral1,Lateral2 lateral
    class Impact1,Impact2,Impact3 impact
    class Governance governance
    class EntryVuln1,EntryVuln2,EntryVuln3,LateralVuln1,LateralVuln2,LateralVuln3,OrchVuln1,OrchVuln2,OrchVuln3,DataVuln1,DataVuln2,DataVuln3,ModelVuln1,ModelVuln2,ModelVuln3,InfraVuln1,InfraVuln2,InfraVuln3 vuln
